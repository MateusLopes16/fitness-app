<div class="dashboard-container">
  <!-- Header Section -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1>Welcome back, <span class="user-name">{{ currentUser()?.name }}</span>!</h1>
      </div>
      <div class="header-actions">
        <button (click)="logout()" class="logout-btn">
          <span class="logout-icon">üö™</span>
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Payment Success/Error Message -->
  <div class="payment-message" *ngIf="paymentMessage" [class.success]="paymentMessage.includes('successful')"
    [class.error]="paymentMessage.includes('cancelled')">
    {{ paymentMessage }}
  </div>

  <!-- Main Dashboard Content -->
  <div class="dashboard-main">

    <!-- Left Column: Profile & Subscription -->
    <div class="dashboard-sidebar">

      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar">
            <span class="avatar-text">{{ currentUser()?.name?.charAt(0)?.toUpperCase() }}</span>
          </div>
          <div class="profile-info">
            <h3>{{ currentUser()?.name }}</h3>
            <p>{{ currentUser()?.email }}</p>
          </div>
          <button class="edit-btn" (click)="toggleEditProfile()">
            <span *ngIf="!isEditingProfile()">‚úèÔ∏è</span>
            <span *ngIf="isEditingProfile()">‚ùå</span>
          </button>
        </div>

        <!-- Editable Profile Form -->
        <form [formGroup]="profileForm" *ngIf="isEditingProfile()" (ngSubmit)="saveProfile()" class="profile-form">
          <div class="form-group">
            <label>Name</label>
            <input type="text" formControlName="name" class="form-input">
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" class="form-input">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Height (cm)</label>
              <input type="number" formControlName="height" class="form-input" placeholder="170">
            </div>
            <div class="form-group">
              <label>Weight (kg)</label>
              <input type="number" formControlName="weight" class="form-input" placeholder="70">
            </div>
          </div>

          <div class="form-group">
            <label>Activity Level</label>
            <select formControlName="activityLevel" class="form-select">
              <option value="">Select activity level</option>
              <option value="SEDENTARY">Sedentary</option>
              <option value="LIGHTLY_ACTIVE">Lightly Active</option>
              <option value="MODERATELY_ACTIVE">Moderately Active</option>
              <option value="VERY_ACTIVE">Very Active</option>
              <option value="EXTREMELY_ACTIVE">Extremely Active</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Fitness Objective</label>
            <select formControlName="objective" class="form-select">
              <option value="MAINTAIN">Maintain Weight</option>
              <option value="BULK">Bulk (Muscle Gain)</option>
              <option value="LEAN">Lean (Fat Loss)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Workouts per Week</label>
            <select formControlName="workoutsPerWeek" class="form-select">
              <option value="0">No workouts</option>
              <option value="1">1 workout</option>
              <option value="2">2 workouts</option>
              <option value="3">3 workouts</option>
              <option value="4">4 workouts</option>
              <option value="5">5 workouts</option>
              <option value="6">6 workouts</option>
              <option value="7">7 workouts</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="save-btn" [disabled]="!profileForm.valid">Save Changes</button>
            <button type="button" class="cancel-btn" (click)="toggleEditProfile()">Cancel</button>
          </div>
        </form>

        <!-- Profile Display -->
        <div class="profile-details" *ngIf="!isEditingProfile()">
          <div class="detail-item">
            <span class="detail-label">Height:</span>
            <span class="detail-value">{{ currentUser()?.height || 'Not set' }} <span
                *ngIf="currentUser()?.height">cm</span></span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Weight:</span>
            <span class="detail-value">{{ currentUser()?.weight || 'Not set' }} <span
                *ngIf="currentUser()?.weight">kg</span></span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Activity Level:</span>
            <span class="detail-value">{{ formatActivityLevel(currentUser()?.activityLevel) || 'Not set' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Objective:</span>
            <span class="detail-value">{{ formatObjective(currentUser()?.objective) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Workouts/Week:</span>
            <span class="detail-value">{{ currentUser()?.workoutsPerWeek || 'Not set' }}</span>
          </div>
        </div>
      </div>

      <!-- Subscription Card -->
      <div class="subscription-card">
        <div class="subscription-header">
          <h3>üéØ Current Plan</h3>
        </div>
        
        <!-- Loading State -->
        <div *ngIf="isLoadingSubscription()" class="subscription-loading">
          <p>Loading subscription...</p>
        </div>
        
        <!-- Subscription Details -->
        <div *ngIf="!isLoadingSubscription()" class="subscription-details">
          <div class="plan-info">
            <div class="plan-name" [style.color]="getSubscriptionPlanColor()">
              {{ getSubscriptionPlanIcon() }} {{ getSubscriptionPlanDisplay() }}
            </div>
            <div class="plan-status" [class.active]="getSubscriptionStatus() === 'ACTIVE'">
              {{ getSubscriptionStatus() }}
            </div>
          </div>
          <div class="subscription-meta">
            <div class="subscription-date">
              <span class="date-label">Started:</span>
              <span class="date-value">{{ getSubscriptionStartDate() | date:'MMM dd, yyyy' }}</span>
            </div>
            <div class="subscription-date" *ngIf="subscription?.currentPeriodEnd">
              <span class="date-label">Renews:</span>
              <span class="date-value">{{ subscription?.currentPeriodEnd | date:'MMM dd, yyyy' }}</span>
              <span class="days-remaining">({{ getRemainingDays() }} days left)</span>
            </div>
            <div class="subscription-actions" *ngIf="subscription?.plan === 'FREE'">
              <button class="upgrade-btn" routerLink="/subscription-plans">
                Upgrade Plan
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Features & Stats -->
    <div class="dashboard-content">

      <!-- Quick Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üî•</div>
          <div class="stat-info">
            <div class="stat-value">{{ calculateBMR() }}</div>
            <div class="stat-label">BMR (Calories)</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-info">
            <div class="stat-value">{{ calculateTDEE() }}</div>
            <div class="stat-label">TDEE (Calories)</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üéØ</div>
          <div class="stat-info">
            <div class="stat-value">{{ calculateTargetCalories() }}</div>
            <div class="stat-label">Target Calories</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ÔøΩ</div>
          <div class="stat-info">
            <div class="stat-value">0</div>
            <div class="stat-label">Today's Intake</div>
          </div>
        </div>
      </div>

      <!-- Feature Cards -->
    </div>
  </div>
</div>